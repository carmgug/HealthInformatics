<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Example</title>
    <style>
        .form-container {
            width: 80%;
            margin: auto;
        }
        .form-row {
            display: flex;
            margin-bottom: 10px;
        }
        .form-row > div {
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .form-row > div:last-child {
            margin-right: 0;
        }
        .form-row input, .form-row select, .form-row textarea {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.0/css/bulma.min.css">
</head>
<body>

<!-- Navbar -->
{% include 'navbar.html' %}

<div class="container " >
    <div class="notification is-primary is-light" >
    <form>
        <!-- Parte 1: Informazioni generali -->
        <h1 class="is-size-4 has-text-centered"><strong>PATIENT INFORMATION</strong>  </h1>
        <div class="form-row">
            <div style="width: 100%;">
                <label for="fiscal-code">Fiscal Code</label>
                <input type="text" id="fiscal-code" name="fiscal-code" required>
            </div>
        </div>
        <div class="form-row">
            <div style="width: 70%;">
                <label for="family-name">Family Name</label>
                <input type="text" id="family-name" name="family-name" required>
            </div>
            <div style="width: 30%;">
                <label for="sex">Sex</label>
                <select id="sex" name="sex" required>
                    <option value="">Select</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="other">Other</option>
                </select>
            </div>
        </div>
        <div class="form-row">
            <div style="width: 70%;">
                <label for="name">Name</label>
                <input type="text" id="name" name="name" required>
            </div>
            <div style="width: 30%;">
                <label for="date">Date</label>
                <input type="date" id="date" name="date" required>
            </div>
        </div>
        <div class="form-row">
            <div style="width: 100%;">
                <label for="address">Address</label>
                <input type="text" id="address" name="address" required>
            </div>
        </div>
        <div class="form-row">
            <div style="width: 50%;">
                <label for="city">City</label>
                <input type="text" id="city" name="city" required>
            </div>
            <div style="width: 50%;">
                <label for="country">Country</label>
                <input type="text" id="country" name="country" required>
            </div>
        </div>
        <div class="form-row">
            <div style="width: 33%;">
                <label for="prov">Prov</label>
                <input type="text" id="prov" name="prov" required>
            </div>
            <div style="width: 34%;">
                <label for="postal-code">Postal Code</label>
                <input type="text" id="postal-code" name="postal-code" required>
            </div>
            <div style="width: 33%;">
                <label for="country-code">Country Code</label>
                <input type="text" id="country-code" name="country-code" required>
            </div>
        </div>
        <div class="form-row">
            <div style="width: 60%;">
                <label for="telephone">Telephone</label>
                <input type="tel" id="telephone" name="telephone" required>
            </div>
            <div style="width: 40%;">
                <label for="language">Language</label>
                <input type="text" id="language" name="language" required>
            </div>
        </div>

        <!-- Parte 2: UREA AND ELECTROLYTES -->
        <h1 class="is-size-4 has-text-centered "><strong>UREA AND ELECTROLYTES</strong></h1>
        <div class="form-row">
            <div style="width: 33%;">
                <label for="potassiumValue">Potassium (MMOLL)</label>
                <input type="text" id="potassiumValue" name="potassiumValue" required>
            </div>
            <div style="width: 33%;">
                <label for="sodiumValue">Sodium (MMOLL)</label>
                <input type="text" id="sodiumValue" name="sodiumValue" required>
            </div>
            <div style="width: 33%;">
                <label for="ureaValue">Urea (MMOLL)</label>
                <input type="text" id="ureaValue" name="ureaValue" required>
            </div>
        </div>

        <!-- Parte 3: BLOOD PRESSURE -->
        <h1 class="is-size-4 has-text-centered"><strong>BLOOD PRESSURE</strong></h1>
        <div class="form-row">
            <div style="width: 50%;">
                <label for="systolicBloodPressureValue">Systolic Blood Pressure (MMHG)</label>
                <input type="text" id="systolicBloodPressureValue" name="systolicBloodPressureValue" required>
            </div>
            <div style="width: 50%;">
                <label for="diastolicBloodPressureValue">Diastolic Blood Pressure (MMHG)</label>
                <input type="text" id="diastolicBloodPressureValue" name="diastolicBloodPressureValue" required>
            </div>
        </div>

        <!-- Parte 4: Note -->
        <h2 class="is-size-4 has-text-centered"><strong>NOTE</strong></h2>
        <div class="form-row">
            <div style="width: 80%;">
                <label for="notes">Notes</label>
                <textarea id="notes" name="notes" rows="4" required></textarea>
            </div>
            <div style="width: 20%;">
                <label for="operatorId">OperatorID</label>
                <input type="number" id="operatorId" name="operatorID" required></input>
            </div>
        </div>
        <div class="form-row">
            <div class="form-row submit-button">
                <button type="button"  class="button is-primary" onclick="submitForm()" >Submit</button>
            </div>
        </div>
    </form>
    </div>
</div>

<script>
    function submitForm() {
        // Impedisci il comportamento predefinito del modulo
        var fiscalCode = document.querySelector('[name="fiscal-code"]').value;
        var name = document.querySelector('[name="name"]').value;
        var familyName = document.querySelector('[name="family-name"]').value;
        var sex = document.getElementById('sex').value;
        var birthDate = document.getElementById('date').value;
        var address = document.getElementById('address').value;
        var city = document.getElementById('city').value;
        var country = document.getElementById('country').value;
        var prov = document.getElementById('prov').value;
        var postalCode = document.getElementById('postal-code').value;
        var countryCode = document.getElementById('country-code').value;
        var telephone = document.getElementById('telephone').value;
        var language = document.getElementById('language').value;
        var notes = document.getElementById('notes').value;

        //Data about first exam
        var potassiumValue = document.getElementById('potassiumValue').value;
        var sodiumValue = document.getElementById('sodiumValue').value;
        var ureaValue = document.getElementById('ureaValue').value;
        //Data about second exam
        var systolicBloodPressureValue = document.getElementById('systolicBloodPressureValue').value;
        var diastolicBloodPressureValue = document.getElementById('diastolicBloodPressureValue').value;
        //Operator ID
        var operatorID = document.getElementById('operatorId').value;

        //build a JSON object
        var data = {
            'patient': {
                'fiscalCode': fiscalCode,
                'name': name,
                'familyName': familyName,
                'sex': sex,
                'birthDate': birthDate,
                'streetAddress': address,
                'city': city,
                'country': country,
                'province': prov,
                'postalCode': postalCode,
                'countryCode': countryCode,
                'phone': telephone,
                'language': language
            },
            'operator': {
                'id': operatorID
            },
            'orders' : [
                {
                    'placerOrderNumber': 123,
                    'testName': 'UREA AND ELECTROLYTES',
                    'potassiumValue': potassiumValue,
                    'potassiumUnit': 'MMOLL',
                    'potassiumReferenceRange': "3.5-5.3",
                    'sodiumValue': sodiumValue,
                    'sodiumUnit': 'MMOLL',
                    'sodiumReferenceRange': "133-146",
                    'ureaValue': ureaValue,
                    'ureaUnit': 'MMOLL',
                    'ureaReferenceRange': "2.5-7.8"
                },
                {
                    'placerOrderNumber': 124,
                    'testName': 'BLOOD PRESSURE',
                    'systolicBloodPressureValue': systolicBloodPressureValue,
                    'systolicBloodPressureUnit': 'MMHG',
                    'systolicBloodPressureReferenceRange': "90-120",
                    'diastolicBloodPressureValue': diastolicBloodPressureValue,
                    'diastolicBloodPressureUnit': 'MMHG',
                    'diastolicBloodPressureReferenceRange': '60-80'
                }
            ],
            'note': notes
        }
        var url = 'http://localhost:5000/send_to_cardiology';

        // Effettua una richiesta POST al tuo Flask API
        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        })
            .then(function(response) {
                return response.json();
            })
            .then(function(data) {
                console.log('Success:', data);
            })
            .catch(function(error) {
                console.error('Error:', error);
            });
    }
</script>


</body>
</html>
